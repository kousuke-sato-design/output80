# 新職業性ストレス簡易調査票フィードバックシステム 要件定義書

## プロジェクト概要

### 目的
職場のメンタルヘルス調査である「新職業性ストレス簡易調査票（80項目版）」のCSVデータをアップロードし、個人および部署別のフィードバックレポートを自動生成・可視化するWebアプリケーションを構築する。

### 技術スタック
- **フロントエンド**: SvelteKit
- **スタイリング**: Tailwind CSS
- **データ処理**: JavaScript/TypeScript
- **チャート**: Chart.js または Recharts（Svelteラッパー）
- **ファイル処理**: Papa Parse（CSV解析）

---

## 機能要件

### 1. CSVアップロード機能
**優先度**: 高

#### 1.1 ファイルアップロード
- ドラッグ&ドロップまたはファイル選択でCSVファイルをアップロード
- 対応形式: `.csv`
- エンコーディング: Shift-JIS, UTF-8自動判定
- ファイルサイズ制限: 10MB以内

#### 1.2 データ検証
- 必須カラムの存在確認
  - ユーザー識別情報（番号、氏名、部署など）
  - 質問(80)項目No001～No080の80列
- データ形式のチェック（1-4点の範囲内）
- エラー表示とバリデーションメッセージ

#### 1.3 プレビュー機能
- アップロード後のデータ一覧表示（最初の10件）
- カラム名とデータ型の確認
- データ件数の表示

---

### 2. データ処理・計算機能
**優先度**: 高

#### 2.1 尺度得点の自動計算
以下の尺度について、PDFの資料5に基づいて得点を計算する：

**A. 仕事の負担（3つの尺度）**
- 仕事の量的負担 = (項目1+2+3) / 3
- 仕事の質的負担 = (項目4+5+6) / 3
- 身体的負担度 = 項目7

**B. 仕事の資源（作業レベル）**
- 仕事のコントロール = (項目8+9+10) / 3
- 仕事の適性 = 項目16
- 技能の活用 = 項目11
- 仕事の意義 = 標準版:(項目17+64+65)/3、短縮版:項目17
- 役割明確さ = 標準版:(項目66+67+68)/3、短縮版:項目66
- 成長の機会 = 標準版:(項目69+70+71)/3、短縮版:項目70
- 新奇性 = (項目72+73+74) / 3
- 予測可能性 = (項目75+76+77) / 3

**C. 仕事の資源（部署レベル）**
- 上司のサポート = (項目47+50+53) / 3
- 同僚のサポート = (項目48+51+54) / 3
- 家族・友人のサポート = (項目49+52+55) / 3
- 経済・地位報酬 = (項目78+79) / 2
- 尊重報酬 = 標準版:(項目80+81)/2、短縮版:項目80
- 安定報酬 = 標準版:(項目82+83+84)/3、短縮版:項目83
- 上司のリーダーシップ = 標準版:(項目85+86+87)/3、短縮版:項目86
- 上司の公正な態度 = 標準版:(項目88+89+90)/3、短縮版:項目90
- ほめてもらえる職場 = 標準版:(項目91+92+93)/3、短縮版:項目92
- 失敗を認める職場 = (項目94+95) / 2
- グループの有能感 = (項目96+97+98) / 3

**D. 仕事の資源（事業場レベル）**
- 経営層との信頼関係 = 標準版:(項目99+100+101)/3、短縮版:項目100
- 変化への対応 = 標準版:(項目102+103+104)/3、短縮版:項目103
- 個人の尊重 = 標準版:(項目108+109+110)/3、短縮版:項目109
- 公正な人事評価 = 標準版:(項目111+112+113)/3、短縮版:項目111
- 多様な労働者への対応 = 標準版:(項目114+115+116)/3、短縮版:項目116
- キャリア形成 = 標準版:(項目117+118+119+120+121)/5、短縮版:項目117
- ワーク・セルフ・バランス(ポジティブ) = 標準版:(項目124+125)/2、短縮版:項目125

**E. いきいきアウトカム**
- 活気 = (項目18+19+20) / 3
- 職場の一体感 = 標準版:(項目128+129+130)/3、短縮版:項目129
- ワーク・エンゲイジメント = (項目131+132) / 2

**F. 心身の健康**
- イライラ感 = (項目21+22+23) / 3
- 疲労感 = (項目24+25+26) / 3
- 不安感 = (項目27+28+29) / 3
- 抑うつ感 = (項目30+31+32+33+34+35) / 6
- 身体愁訴 = (項目36～46の合計) / 11
- 心理的ストレス反応合計 = (項目18～35の合計) / 18

**G. 職場のハラスメント**
- 職場のハラスメント = 標準版:(項目126+127)/2、短縮版:項目126

**H. 満足度**
- 仕事満足度 = 項目56
- 家庭満足度 = 項目57

**I. 仕事のパフォーマンス**
- 業務の遂行 = (項目133+134+135) / 3
- 創造性の発揮 = (項目136+137+138) / 3
- 積極的な学習 = (項目139+140+141) / 3

#### 2.2 対策領域別の合計点計算
- 仕事の負担合計 = (量的負担+質的負担+身体的負担+対人関係+職場環境+情緒的負担+役割葛藤+ワーク・セルフ・バランス(ネガティブ)) / 8
- 作業レベル資源合計 = (コントロール+仕事の適性+技能の活用+仕事の意義+役割明確さ+成長の機会) / 6
- 部署レベル資源合計 = (上司サポート+同僚サポート+経済地位報酬+尊重報酬+安定報酬+リーダーシップ+上司の公正な態度+ほめてもらえる職場+失敗を認める職場) / 9
- 事業場レベル資源合計 = (経営層との信頼関係+変化への対応+個人の尊重+公正な人事評価+多様な労働者への対応+キャリア形成+ワーク・セルフ・バランス(ポジティブ)) / 7

#### 2.3 全国平均データとの比較
- 資料6の全国平均データを内部データとして保持
- 各尺度について、全国平均・事業場平均との比較値を算出
- 偏差の可視化

---

### 3. 個人フィードバック機能
**優先度**: 高

#### 3.1 いきいきプロフィール全体図
- 縦軸: 個人と職場のいきいき（ワーク・エンゲイジメント+活気+職場の一体感）
- 横軸: 職場のいきいき（職場の一体感）
- 散布図で表示、当該職場・事業場平均・全国平均をプロット

#### 3.2 レーダーチャート
4つのレーダーチャートを表示：
1. **仕事の負担合計**（8項目）
2. **作業レベル資源合計**（6項目）
3. **部署レベル資源合計**（9項目）
4. **事業場レベル資源合計**（7項目）

各チャートに以下の3つのラインを表示：
- 当該職場（青線）
- 事業場平均（グレー線）
- 全国平均（オレンジ線）

#### 3.3 棒グラフ比較
以下の項目について横棒グラフで比較：
- 仕事の負担プロフィール（8項目）
- 仕事の資源（作業レベル）プロフィール（6項目）
- 仕事の資源（部署レベル）プロフィール（9項目）
- 仕事の資源（事業場レベル）プロフィール（7項目）
- 健康および満足度プロフィール（10項目）

各グラフに3つのバーを表示：
- 当該職場（濃い色）
- 事業場平均（中間色）
- 全国平均（薄い色）

---

### 4. 部署別フィードバック機能
**優先度**: 中

#### 4.1 部署選択機能
- アップロードされたCSVから部署情報を自動抽出
- ドロップダウンで部署を選択
- 複数部署の比較表示

#### 4.2 部署別集計
- 部署内の平均値を自動計算
- 回答者数の表示
- 部署間の比較分析

#### 4.3 部署別レポート生成
- 個人フィードバックと同じ形式で部署別データを表示
- いきいき度分布図
- レーダーチャート
- 棒グラフ比較

---

### 5. データエクスポート機能
**優先度**: 中

#### 5.1 PDFエクスポート
- 個人/部署別レポートのPDF出力
- チャートと数値データを含む
- 印刷最適化されたレイアウト

#### 5.2 CSVエクスポート
- 計算結果をCSV形式でダウンロード
- 全尺度得点を含む
- 元データ+計算結果の統合版

---

### 6. UI/UX要件

#### 6.1 レイアウト
- レスポンシブデザイン（PC・タブレット対応）
- ヘッダー: システム名、ナビゲーション
- メインエリア: コンテンツ表示
- サイドバー（オプション）: 部署選択、フィルタ

#### 6.2 カラースキーム
- プライマリカラー: 青系（#3B82F6）
- セカンダリカラー: グレー系（#6B7280）
- アクセントカラー: オレンジ系（#F59E0B）
- 背景: 白・ライトグレー（#F9FAFB）

#### 6.3 コンポーネント設計
- ファイルアップロードエリア（ドラッグ&ドロップ対応）
- データテーブル（ソート・フィルタ機能付き）
- チャートコンポーネント（レーダーチャート、棒グラフ、散布図）
- エクスポートボタン（PDF、CSV）
- ローディングインジケーター
- エラー/成功メッセージ

---

### 7. ページ構成

#### 7.1 トップページ（/）
- システム概要
- CSVアップロードエリア
- 使い方の説明

#### 7.2 データ確認ページ（/preview）
- アップロードしたCSVのプレビュー
- データ件数、部署一覧の表示
- 分析開始ボタン

#### 7.3 個人レポートページ（/report/individual/[id]）
- 個人別のフィードバックレポート
- いきいきプロフィール全体図
- レーダーチャート（4種類）
- 棒グラフ比較
- エクスポート機能

#### 7.4 部署別レポートページ（/report/department/[dept]）
- 部署別の集計レポート
- 部署内の平均値とグラフ
- 全国平均との比較

#### 7.5 比較分析ページ（/analysis）
- 複数部署の比較
- 経年変化の分析（将来的な機能）

---

## 非機能要件

### 8. パフォーマンス
- ページ読み込み時間: 3秒以内
- CSVアップロード処理: 5秒以内（1000件まで）
- チャート描画: 1秒以内

### 9. ブラウザ対応
- Chrome（最新版）
- Edge（最新版）
- Firefox（最新版）
- Safari（最新版）

### 10. セキュリティ
- クライアントサイドでのデータ処理（サーバーへのアップロード不要）
- 個人情報の保護（データは一時的にのみブラウザに保持）
- XSS対策（入力値のサニタイズ）

### 11. アクセシビリティ
- WCAG 2.1 Level AA準拠
- キーボード操作対応
- スクリーンリーダー対応

---

## 技術実装詳細

### 12. ディレクトリ構成
```
output80/
├── src/
│   ├── lib/
│   │   ├── components/
│   │   │   ├── FileUpload.svelte
│   │   │   ├── DataTable.svelte
│   │   │   ├── RadarChart.svelte
│   │   │   ├── BarChart.svelte
│   │   │   ├── ScatterPlot.svelte
│   │   │   └── ExportButton.svelte
│   │   ├── utils/
│   │   │   ├── csvParser.ts
│   │   │   ├── scoreCalculator.ts
│   │   │   ├── dataValidator.ts
│   │   │   └── exportUtils.ts
│   │   ├── stores/
│   │   │   └── dataStore.ts
│   │   ├── types/
│   │   │   └── index.ts
│   │   └── data/
│   │       └── nationalAverages.ts（全国平均データ）
│   ├── routes/
│   │   ├── +page.svelte（トップページ）
│   │   ├── preview/
│   │   │   └── +page.svelte
│   │   ├── report/
│   │   │   ├── individual/
│   │   │   │   └── [id]/
│   │   │   │       └── +page.svelte
│   │   │   └── department/
│   │   │       └── [dept]/
│   │   │           └── +page.svelte
│   │   └── analysis/
│   │       └── +page.svelte
│   └── app.html
├── static/
├── tailwind.config.js
├── svelte.config.js
├── package.json
└── claude.md（本ファイル）
```

### 13. データモデル

#### UserData
```typescript
interface UserData {
  id: string;
  name: string;
  department: string;
  responses: number[]; // 80項目の回答（1-4点）
  scores?: ScoreData; // 計算後の尺度得点
}
```

#### ScoreData
```typescript
interface ScoreData {
  // 仕事の負担
  quantitativeLoad: number;
  qualitativeLoad: number;
  physicalLoad: number;

  // 仕事の資源（作業レベル）
  jobControl: number;
  jobFitness: number;
  skillUtilization: number;
  jobSignificance: number;
  roleClarification: number;
  growthOpportunity: number;
  novelty: number;
  predictability: number;

  // 仕事の資源（部署レベル）
  supervisorSupport: number;
  colleagueSupport: number;
  familySupport: number;
  economicReward: number;
  respectReward: number;
  stabilityReward: number;
  supervisorLeadership: number;
  supervisorFairness: number;
  praisableWorkplace: number;
  failureAcceptance: number;
  groupEfficacy: number;

  // 仕事の資源（事業場レベル）
  managementTrust: number;
  changeAdaptation: number;
  individualRespect: number;
  fairEvaluation: number;
  diversitySupport: number;
  careerDevelopment: number;
  workSelfBalancePositive: number;

  // いきいきアウトカム
  vigor: number;
  workplaceUnity: number;
  workEngagement: number;

  // 心身の健康
  irritation: number;
  fatigue: number;
  anxiety: number;
  depression: number;
  physicalComplaints: number;
  psychologicalStress: number;

  // その他
  harassment: number;
  jobSatisfaction: number;
  familySatisfaction: number;

  // 合計点
  totalWorkload: number;
  totalTaskLevelResources: number;
  totalDepartmentLevelResources: number;
  totalOrganizationLevelResources: number;
}
```

#### NationalAverage
```typescript
interface NationalAverage {
  scaleName: string;
  itemCount: number;
  average: number;
  standardDeviation: number;
}
```

### 14. 使用ライブラリ
```json
{
  "dependencies": {
    "@sveltejs/kit": "^2.0.0",
    "svelte": "^4.0.0",
    "papaparse": "^5.4.1",
    "chart.js": "^4.4.0",
    "svelte-chartjs": "^3.1.0",
    "jspdf": "^2.5.1",
    "jspdf-autotable": "^3.8.0",
    "html2canvas": "^1.4.1"
  },
  "devDependencies": {
    "tailwindcss": "^3.4.0",
    "autoprefixer": "^10.4.0",
    "postcss": "^8.4.0",
    "typescript": "^5.0.0",
    "@types/papaparse": "^5.3.0"
  }
}
```

---

## 開発フェーズ

### フェーズ1: 基本機能（必須）
- [ ] プロジェクトセットアップ（SvelteKit + Tailwind CSS）
- [ ] CSVアップロード機能
- [ ] データ検証機能
- [ ] 尺度得点計算ロジック
- [ ] 全国平均データの組み込み

### フェーズ2: 可視化機能（必須）
- [ ] レーダーチャートコンポーネント
- [ ] 棒グラフコンポーネント
- [ ] 散布図コンポーネント
- [ ] 個人レポートページ
- [ ] データテーブル表示

### フェーズ3: 高度な機能（推奨）
- [ ] 部署別レポート機能
- [ ] 複数部署比較機能
- [ ] PDFエクスポート
- [ ] CSVエクスポート

### フェーズ4: 改善・最適化（オプション）
- [ ] パフォーマンス最適化
- [ ] アクセシビリティ対応
- [ ] エラーハンドリング強化
- [ ] ユーザーガイド作成

---

## 備考

- このシステムはクライアントサイドで完結し、サーバーにデータを送信しない
- 個人情報保護の観点から、データは一時的にのみブラウザのメモリに保持
- 将来的には複数回の調査データを保存し、経年変化を分析する機能も検討

---

## 参考資料

1. 新職業性ストレス簡易調査票（80項目版）PDF
2. 資料5: 得点計算方法
3. 資料6: 全国平均データ
4. 資料7: フィードバック方法の説明
